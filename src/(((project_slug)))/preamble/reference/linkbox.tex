((* if "colorful_box" in reference_options *))
\usepackage{tcolorbox}

%% Universal style options applied to all links
\tcbset{
  link/.style={
    colupper=black,
    nobeforeafter, box align=base, boxsep=0em,
    before upper={\vphantom{]}},
    left=0.15em, right=0.15em, top=0.25ex, bottom=0.05ex,
    arc=0.1em, rounded corners=all, boxrule=0.3mm,
    grow sidewards by=0.05em,
    enlarge bottom by=-0.05ex,
    enlarge top by=-0.4ex,
  }
}

%% Style modifications for different types of links
\tcbset{
  refbox/.style ={
    colframe=black!30, colback=black!3,
    fontupper=\sffamily,
  },
  pagebox/.style={
    refbox, boxsep=0.1ex, bottom=0.25ex,
    fontupper=\ttfamily,
  },
  hrefbox/.style={
    colframe=black!10!UrlColor!70, colback=UrlColor!15,
  },
  citebox/.style={
    left=0em, right=0em, bottom=0.25ex,
    colframe=black!10!CiteColor!80, colback=CiteColor!20,
    fontupper=\ttfamily,
  },
}

%% Definition of the link boxes
\NewTCBox{\refbox} {O{}}{link,refbox, #1}
\NewTCBox{\pagebox}{O{}}{link,pagebox,#1}
\NewTCBox{\hrefbox}{O{}}{link,hrefbox,#1}
\NewTCBox{\citebox}{O{}}{link,citebox,#1}
((* else *))
%% Definition of the link boxes
\NewDocumentCommand{\refbox} {O{} m}{#2}
\NewDocumentCommand{\pagebox}{O{} m}{\texttt{#2}}
\NewDocumentCommand{\hrefbox}{O{} m}{#2}
\NewDocumentCommand{\citebox}{O{} m}{\texttt{#2}}
((* endif *))

%% Save old commands
\NewCommandCopy{\hrefold}{\href}
\NewCommandCopy{\urlold}{\url}

%% Enhance hyperlink commands with link boxes
\RenewDocumentCommand{\href}{O{} m m}{\hrefold{#2}{\hrefbox[#1]{#3}}}
\RenewDocumentCommand{\url}{O{} m}{\href[#1]{#2}{\nolinkurl{#2}}}
