%% Automatic `zcref` type name declaration for environments
%%   #1 - type name
%%   #2 - plural form (optional)
\NewDocumentCommand{\DeclareCleverTypeName}{m o}{
  \zcRefTypeSetup{#1}{
    name-sg = #1,
    Name-sg = \MakeTitlecase{#1},
    name-pl = \IfValueTF{#2}{#2}{#1s},
    Name-pl = \MakeTitlecase{\IfValueTF{#2}{#2}{#1}s},
  }
  \zcRefTypeSetup{#1*}{
    name-sg = #1,
    Name-sg = \MakeTitlecase{#1},
    name-pl = \IfValueTF{#2}{#2}{#1s},
    Name-pl = \MakeTitlecase{\IfValueTF{#2}{#2}{#1}s},
  }
}
  
%% Automatically generate starred unnumbered versions of environments
\NewDocumentCommand{\DeclareTheoremEnv}{m o}{
  \IfValueTF{#2}{
    \declarekeytheorem{#1}[#2, name=\MakeTitlecase{#1}]
    \declarekeytheorem{#1*}[#2, name=\MakeTitlecase{#1}, numbered=false]
  }{
    \declarekeytheorem{#1}[name=\MakeTitlecase{#1}]
    \declarekeytheorem{#1*}[name=\MakeTitlecase{#1}, numbered=false]
  }
}

%% Theorem-like environment
% Cancel the reserved space for qed symbol
\newcommand*{\theoremqed}{\hspace{-1.195em}\strut}
% Factory for theorem-like environments
%   #1 - key-value options (optional)
%   #2 - environment name
%   #3 - plural form for cleveref (optional)
\NewDocumentCommand{\NewTheoremLike}{O{qed=\theoremqed} m o}{
  \DeclareTheoremEnv{#2}[
    sibling=table,
    style=thmcommon,
    #1,
    tcolorbox-no-titlebar={parbox=false, breakable},
  ]
  \DeclareCleverTypeName{#2}[#3]
}
\NewDocumentCommand{\NewTheoremLikes}{>{\SplitList{,}} m}{
  \ProcessList{#1}{\NewTheoremLike}
}

%% Remark-like environment
% Put a cornered box instead of qed symbol
\newcommand*{\remarkqed}{\hspace{-0.9em}\textcolor{black!60}{\(\lrcorner\)}\strut}
% Factory for remark-like environments
%   #1 - key-value options (optional)
%   #2 - environment name
%   #3 - plural form for cleveref (optional)
\NewDocumentCommand{\NewRemarkLike}{O{qed=\remarkqed} m o}{
  \DeclareTheoremEnv{#2}[
    sibling=table,
    style=thmcommon,
    #1,
    tcolorbox-no-titlebar={parbox=false, breakable},
  ]
  \DeclareCleverTypeName{#2}[#3]
}
\NewDocumentCommand{\NewRemarkLikes}{>{\SplitList{,}} m}{
    \ProcessList{#1}{\NewRemarkLike}
}

%% Todo-like environment
% Base style for todo-like environments
\tcbset{
  todolike/.style={
    % breakable, after upper=\strut, parbox=false,
    breakable, parbox=false,
    colframe=pink, sharp corners=west, boxrule=0pt, leftrule=4pt,
    coltitle=black, fonttitle=\sffamily\bfseries,
    attach title to upper={\ },
    beforeafter skip=0.5\baselineskip plus 2pt,
  }
}
% Factory for new todo-like environments
%   #1 - environment name
%   #2 - background color
\NewDocumentCommand{\NewTodoLike}{m m}{
  \NewTColorBox{#1}{o}{
    todolike,
    colback=#2,
    title={#1\IfValueT{##1}{ \textmd{(##1)}}.}
  }
}
% Quick inline todo command
%   #1 - optional short label
%   #2 - todo text
\NewDocumentCommand{\todo}{O{} >{\TrimSpaces} m}{%
  \textcolor{red}{%
    \textsf{TODO\IfBlankF{#1}{(#1)}}%
    \IfBlankTF{#2}{.}{: #2}%
  }%
}

((* if "custom_env" in environment_options *))
%% Custom environments
\NewTheoremLikes{definition, theorem, lemma, proposition}
\NewTheoremLike{corollary}[corollaries]
\NewRemarkLikes{remark, example, idea, tip, slogan}
\NewTodoLike{Todo}{pink!20}
\NewTodoLike{Question}{orange!10}
\NewTodoLike{Suggestion}{cyan!10}
\NewTodoLike{Note}{cyan!50!green!10}
((* endif *))
